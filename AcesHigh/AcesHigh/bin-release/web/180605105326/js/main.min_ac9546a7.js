var __reflect=this&&this.__reflect||function(t,i,e){t.__class__=i,e?e.push(i):e=[i],t.__types__=t.__types__?e.concat(t.__types__):e},__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);e.prototype=i.prototype,t.prototype=new e},__awaiter=this&&this.__awaiter||function(t,i,e,n){return new(e||(e=Promise))(function(a,o){function s(t){try{h(n.next(t))}catch(i){o(i)}}function r(t){try{h(n["throw"](t))}catch(i){o(i)}}function h(t){t.done?a(t.value):new e(function(i){i(t.value)}).then(s,r)}h((n=n.apply(t,i||[])).next())})},__generator=this&&this.__generator||function(t,i){function e(t){return function(i){return n([t,i])}}function n(e){if(a)throw new TypeError("Generator is already executing.");for(;h;)try{if(a=1,o&&(s=o[2&e[0]?"return":e[0]?"throw":"next"])&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[0,s.value]),e[0]){case 0:case 1:s=e;break;case 4:return h.label++,{value:e[1],done:!1};case 5:h.label++,o=e[1],e=[0];continue;case 7:e=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===e[0]||2===e[0])){h=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){h.label=e[1];break}if(6===e[0]&&h.label<s[1]){h.label=s[1],s=e;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(e);break}s[2]&&h.ops.pop(),h.trys.pop();continue}e=i.call(t,h)}catch(n){e=[6,n],o=0}finally{a=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var a,o,s,r,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:e(0),"throw":e(1),"return":e(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},mokuai;!function(t){var i;!function(t){t[t.TOP=0]="TOP",t[t.BOTTOM=1]="BOTTOM",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"}(i=t.ConstraintDirect||(t.ConstraintDirect={}));var e;!function(t){t[t.SIMPLE=0]="SIMPLE",t[t.FF=1]="FF",t[t.NN=2]="NN"}(e=t.BODY_SHAPE_TYPE||(t.BODY_SHAPE_TYPE={}));var n;!function(t){t[t.HE_XIN=0]="HE_XIN",t[t.ZHUANG_JIA=1]="ZHUANG_JIA",t[t.WU_QI=2]="WU_QI",t[t.CAN_HAI=3]="CAN_HAI"}(n=t.MO_KUAI_TYPE||(t.MO_KUAI_TYPE={})),t.SIMPLE_SIZE=16,t.FF_SIZE=32,t.NN_SIZE=48,t.SIMPLE_SIZE_PH=.32,t.FF_SIZE_PH=.64,t.NN_SIZE_PH=.96,t.M_SIZE=[t.SIMPLE_SIZE,t.FF_SIZE,t.NN_SIZE],t.M_SIZE_PH=[t.SIMPLE_SIZE_PH,t.FF_SIZE_PH,t.NN_SIZE_PH];var a=function(t){function i(i,e,n,a){var o=t.call(this,RES.getRes(n))||this;return o.mark_number=-1,o.rm_herd=!1,o.relativeDistance=egret.Point.create(0,0),o.shapeType=e,o.moKuaiPost=i,o.fc=a,o.initAnch(),o}return __extends(i,t),i.prototype.initAnch=function(){this.anchorOffsetX=.5*this.width,this.anchorOffsetY=.5*this.height},i.prototype.UpdataPosition=function(t){this.x=t.x+this.relativeDistance.x,this.y=t.y+this.relativeDistance.y},i.prototype.updata=function(){},i}(egret.Bitmap);t.MoKuaiBase=a,__reflect(a.prototype,"mokuai.MoKuaiBase")}(mokuai||(mokuai={}));var zidan;!function(t){var i=function(t){function i(i,e,n){var a=t.call(this,{mass:e})||this;return a.is_kick=!0,a.is_coll=!0,a.zhenying=i,a.wqt=n,a.initColl(),a.initZidan(),a}return __extends(i,t),i.prototype.initZidan=function(){var t=new p2.Box({width:mokuai.M_SIZE_PH[mokuai.BODY_SHAPE_TYPE.SIMPLE],height:mokuai.M_SIZE_PH[mokuai.BODY_SHAPE_TYPE.SIMPLE]});this.addShape(t),t.collisionMask=this.collMask,t.collisionGroup=this.collGroup},i.prototype.initColl=function(){this.zhenying==GameConstant.ZHEN_YING.WO_JUN&&(this.collGroup=GameConstant.WO_JUN,this.collMask=GameConstant.DI_JUN|GameConstant.ZHONG_LI),this.zhenying==GameConstant.ZHEN_YING.DI_JUN&&(this.collGroup=GameConstant.DI_JUN,this.collMask=GameConstant.WO_JUN|GameConstant.ZHONG_LI),this.zhenying==GameConstant.ZHEN_YING.ZHONG_LI&&(this.collGroup=GameConstant.ZHONG_LI,this.collMask=GameConstant.DI_JUN|GameConstant.ZHONG_LI|GameConstant.WO_JUN)},i.prototype.updata=function(){},i}(p2.Body);t.ZiDanBase=i,__reflect(i.prototype,"zidan.ZiDanBase")}(zidan||(zidan={}));var ai;!function(t){var i;!function(t){t[t.xuan_zhuan=0]="xuan_zhuan",t[t.miao_zhun=1]="miao_zhun"}(i=t.AI_TYPE||(t.AI_TYPE={}));var e;!function(t){t[t.ZS=0]="ZS",t[t.ZX=1]="ZX",t[t.YS=2]="YS",t[t.YX=3]="YX"}(e=t.WEI_ZHI||(t.WEI_ZHI={}));var n;!function(t){t[t.Clockwise=0]="Clockwise",t[t.Anti_clockwise=1]="Anti_clockwise"}(n=t.ZHUAN_XIANG||(t.ZHUAN_XIANG={}));var a=function(){function t(t){this.hang_up=!1,this.fc=t,this.sceneConsole=t.battle_scene,this.suke=this.sceneConsole.sk}return t.prototype.doUpData=function(t){},t}();t.AiBase=a,__reflect(a.prototype,"ai.AiBase")}(ai||(ai={}));var feichuan;!function(t){var i;!function(t){t[t.SUKE=0]="SUKE",t[t.DIJI=1]="DIJI",t[t.CANHAI=2]="CANHAI"}(i=t.FC_TYPE||(t.FC_TYPE={}));var e=function(t){function i(i,e,n){var a=t.call(this,{mass:1})||this;return a.mokuai_size=0,a.heXinList=new Array,a.zhuangJaList=new Array,a.ais=new Array,a.egretWorldPoint=e,a.battle_scene=i,a.zhenying=n,a.initPhPost(),a.initColl(),a}return __extends(i,t),i.prototype.initJson=function(t){var i=RES.getRes(t);this.W=i.layers[0].width,this.H=i.layers[0].height,this.initList(this.H,this.W);var e=i.layers[0].data;this.moKuaiList=new Array(this.H);for(var n=0,a=0;a<this.H;a++){this.moKuaiList[a]=new Array(this.W);for(var o=0;o<this.W;o++)if(0!=e[n]){var s=i.tiles[e[n]-1].image.replace(".","_"),r=void 0;"ship6-81_png"==s?(r=new mokuai.DongLiHeXin(egret.Point.create(o,a),mokuai.BODY_SHAPE_TYPE.SIMPLE,s,this),this.hx=r):r=new zhuangjia.PuTongZhuangJia(egret.Point.create(o,a),mokuai.BODY_SHAPE_TYPE.SIMPLE,s,this);var h=Physics.getRelativeDistance(egret.Point.create(this.W,this.H),egret.Point.create(o,a),mokuai.M_SIZE_PH[mokuai.BODY_SHAPE_TYPE.SIMPLE]),u=new p2.Box({width:mokuai.M_SIZE_PH[mokuai.BODY_SHAPE_TYPE.SIMPLE],height:mokuai.M_SIZE_PH[mokuai.BODY_SHAPE_TYPE.SIMPLE]});u.collisionGroup=this.collGroup,u.collisionMask=this.collMask,this.addShape(u,[h.x,h.y]),this.moKuaiList[a][o]=r,r.boxShape=u,this.battle_scene.addChild(r),this.mokuai_size++,n++}else n++}this.battle_scene.world.addBody(this)},i.prototype.initColl=function(){this.zhenying==GameConstant.ZHEN_YING.WO_JUN&&(this.collGroup=GameConstant.WO_JUN,this.collMask=GameConstant.DI_JUN|GameConstant.ZHONG_LI),this.zhenying==GameConstant.ZHEN_YING.DI_JUN&&(this.collGroup=GameConstant.DI_JUN,this.collMask=GameConstant.WO_JUN|GameConstant.ZHONG_LI),this.zhenying==GameConstant.ZHEN_YING.ZHONG_LI&&(this.collGroup=GameConstant.ZHONG_LI,this.collMask=GameConstant.DI_JUN|GameConstant.ZHONG_LI|GameConstant.WO_JUN)},i.prototype.initPhPost=function(){var t=Tools.egretTOp2(this.egretWorldPoint);this.position[0]=t.x,this.position[1]=t.y},i.prototype.initList=function(t,i){this.moKuaiList=new Array;for(var e=0;t>e;e++)this.moKuaiList.push(new Array(i));this.wuqiList=new Array,this.removeMoKuai=new Array},i.prototype.updataFenJie=function(){this.fen_jie=new Array;for(var t=0;10>t;t++)this.fen_jie.push([])},i.prototype.updataPos=function(){var t=this.moKuaiList.length,i=this.moKuaiList[0].length;this instanceof shuke.ShuKe&&(this.angle=0);for(var e=0;t>e;e++)for(var n=0;i>n;n++)if(this.moKuaiList[e][n]){var a=this.moKuaiList[e][n].boxShape,o=this.moKuaiList[e][n],s=Math.PI/180*360-this.angle,r=Math.cos(s)*a.position[0]+Math.sin(s)*a.position[1],h=-Math.sin(s)*a.position[0]+Math.cos(s)*a.position[1],u=Tools.p2TOegretPoitn(egret.Point.create(r+this.position[0],h+this.position[1]));o.x=u.x,o.y=u.y,o.markPoint=u,o.rotation=360-180*this.angle/Math.PI}},i.prototype.updataSomeThing=function(){this.updataPos(),this.updataAI()},i.prototype.updataAI=function(){for(var t=0,i=this.ais;t<i.length;t++){var e=i[t];e.doUpData(egret.getTimer())}},i.prototype.getMokWorldpos=function(t){var i=Math.PI/180*360-this.angle,e=Math.cos(i)*t.x+Math.sin(i)*t.y,n=-Math.sin(i)*t.x+Math.cos(i)*t.y;return egret.Point.create(e+this.position[0],n+this.position[1])},i.prototype.initPro=function(t){var i=egret.Point.create(t[0].length,t.length);this.initList(t.length,t[0].length);for(var e=0;e<t.length;e++)for(var n=0;n<t[0].length;n++)this.initMokuai(t[e][n],e,n,i);this.battle_scene.world.addBody(this)},i.prototype.initMokuai=function(t,i,e,n){var a;if(3==t){a=new wuqi.PuTongDan(egret.Point.create(e,i),mokuai.BODY_SHAPE_TYPE.SIMPLE,"lan_dian_png",wuqi.WUQI_TYPE.PU_TONG,this);var o=a;this.wuqiList.push(o)}if(2==t&&(a=new zhuangjia.PuTongZhuangJia(egret.Point.create(e,i),mokuai.BODY_SHAPE_TYPE.SIMPLE,"hong_dian_png",this)),1==t&&(a=new mokuai.DongLiHeXin(egret.Point.create(e,i),mokuai.BODY_SHAPE_TYPE.SIMPLE,"huang_dian_png",this),this.hx=a),0!=t){var s=Physics.getRelativeDistance(n,egret.Point.create(e,i),mokuai.M_SIZE_PH[mokuai.BODY_SHAPE_TYPE.SIMPLE]),r=new p2.Box({width:mokuai.M_SIZE_PH[mokuai.BODY_SHAPE_TYPE.SIMPLE],height:mokuai.M_SIZE_PH[mokuai.BODY_SHAPE_TYPE.SIMPLE]});r.collisionGroup=this.collGroup,r.collisionMask=this.collMask,this.addShape(r,[s.x,s.y]),this.moKuaiList[i][e]=a,a.boxShape=r,this.battle_scene.addChild(a),this.mokuai_size++}},i.prototype.checkCollision=function(t,i){for(var e,n=1e3,a=1e3,o=0;o<this.moKuaiList.length;o++)for(var s=0;s<this.moKuaiList[o].length;s++){var r=this.moKuaiList[o][s];if(r){var h=Math.abs(r.x-t),u=Math.abs(r.y-i);n+a>h+u&&(n=h,a=u,e=r)}}this.moKuaiList[e.moKuaiPost.y][e.moKuaiPost.x]=null,this.battle_scene.removeFeiChuan.push(this),this.removeMoKuai.push(e),e instanceof mokuai.DongLiHeXin&&(this.hx=null)},i.prototype.dellMokuai=function(){for(var t=0;t<this.removeMoKuai.length;t++){var i=this.removeMoKuai.pop();this.moKuaiList[i.moKuaiPost.y][i.moKuaiPost.x]=null,this.removeShape(i.boxShape),this.battle_scene.removeChild(i)}},i.prototype.fenJie=function(){for(var t=this.fen_jie.length,i=0;t>i;i++){for(var e=this.fen_jie.pop(),n=(e.length,!1),a=0,o=e;a<o.length;a++){var s=o[a];s&&(n=!0)}if(n){new canhai.CanHai(this,e)}}},i.prototype.addAI=function(t){this.ais.push(t)},i}(p2.Body);t.FeiChuanBase=e,__reflect(e.prototype,"feichuan.FeiChuanBase")}(feichuan||(feichuan={}));var zhuangjia;!function(t){var i=function(t){function i(i,e,n,a){var o=t.call(this,i,e,n,a)||this;return o.moKuaiType=mokuai.MO_KUAI_TYPE.ZHUANG_JIA,o}return __extends(i,t),i}(mokuai.MoKuaiBase);t.ZhuangJiaBase=i,__reflect(i.prototype,"zhuangjia.ZhuangJiaBase")}(zhuangjia||(zhuangjia={}));var scene;!function(t){t.battle_sceneW=4e3,t.battle_sceneH=4e3,t.scene_anch_x=1e3,t.scene_anch_y=1e3,t.scene_wy_limit=200,t.scene_wy_bfb=.2;var i=function(i){function e(){var t=i.call(this)||this;return t.p2_wy_x=0,t.p2_wy_y=0,t._distance=new egret.Point,t._skP=new egret.Point,t.init(),t.initcoll(),t}return __extends(e,i),e.prototype.init=function(){this.width=t.battle_sceneW,this.height=t.battle_sceneH,this.world=new p2.World,this.world.gravity=[0,0],this.addShuKeListener(),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.dijis=new Array,this.removeBodyList=new Array,this.removeFeiChuan=new Array},e.prototype.initcoll=function(){var t=this;this.world.on("beginContact",function(i){if(i.bodyB instanceof zidan.PuTongZiDan||i.bodyA instanceof zidan.PuTongZiDan){var e=i.bodyB instanceof zidan.PuTongZiDan?i.bodyB:i.bodyA,n=e;n.is_kick&&t.removeBodyList.push(n)}if(i.bodyB instanceof feichuan.FeiChuanBase||i.bodyA instanceof feichuan.FeiChuanBase){var e=i.bodyB instanceof feichuan.FeiChuanBase?i.bodyB:i.bodyA,a=i.bodyB instanceof feichuan.FeiChuanBase?i.bodyA:i.bodyB,o=e;if((o.zhenying==GameConstant.ZHEN_YING.DI_JUN||o.zhenying==GameConstant.ZHEN_YING.ZHONG_LI)&&a instanceof zidan.ZiDanBase){var s=a;s.is_coll&&(o.checkCollision(a.displays[0].x,a.displays[0].y),s.is_coll=!1)}}})},e.prototype.onEnterFrame=function(){this.chackColl(),this.chackFeiChuan(),this.p2Updata()},e.prototype.chackColl=function(){for(var t=this.removeBodyList.length,i=0;t>i;i++){var e=this.removeBodyList.pop();if(e.is_kick){e.is_kick=!1;var n=e.displays[0];n&&this.removeChild(n),this.world.removeBody(e)}}},e.prototype.chackFeiChuan=function(){for(var t=0;t<this.removeFeiChuan.length;t++){for(var i=this.removeFeiChuan.pop(),e=0;e<i.removeMoKuai.length;e++){var n=i.removeMoKuai.pop();i.removeShape(n.boxShape),this.removeChild(n),i.mokuai_size--}if(!GameConstant.chackMoKuaiNumber(i))return;GameConstant.diaoluo(i),i&&i.mokuai_size>0&&i.fenJie()}},e.prototype.p2Updata=function(){this.updataSKNow(),this.world.step(.06);for(var t=this.world.bodies.length,i=0;t>i;i++){var e=this.world.bodies[i];if(!this.sk_p2_now||e instanceof shuke.ShuKe||(e.position[0]=e.position[0]+this.sk_p2_now.x,e.position[1]=e.position[1]+this.sk_p2_now.y),e instanceof shuke.ShuKe)for(var n=e,a=0,o=n.wuqiList;a<o.length;a++){var s=o[a];s.updata_wq(e.angle)}if(e instanceof canhai.CanHai,e instanceof feichuan.FeiChuanBase){var r=e;r.updataSomeThing()}else{var h=e.displays[0];if(h){var u=Tools.p2TOegretPoitn(egret.Point.create(e.position[0],e.position[1]));h.x=u.x,h.y=u.y,h.rotation=360-180*e.angle/Math.PI}}}this.updataSKBefor()},e.prototype.updataSKBefor=function(){return this.sk_p2_befor?(this.sk_p2_befor.x=this.sk.position[0],void(this.sk_p2_befor.y=this.sk.position[1])):void(this.sk_p2_befor=egret.Point.create(this.sk.position[0],this.sk.position[1]))},e.prototype.updataSKNow=function(){this.sk_p2_befor&&(this.sk_p2_now||(this.sk_p2_now=egret.Point.create(0,0)),this.sk_p2_now.x=.1*(this.sk_p2_befor.x-this.sk.position[0]),this.sk_p2_now.y=.1*(this.sk_p2_befor.y-this.sk.position[1]))},e.prototype.addShuKeListener=function(){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this)},e.prototype.mouseUp=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},e.prototype.mouseDown=function(t){this._distance.x=t.stageX,this._distance.y=t.stageY,this._skP.x=this.sk.position[0],this._skP.y=this.sk.position[1],this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},e.prototype.mouseMove=function(t){var i=egret.Point.create((t.stageX-this._distance.x)/Physics.factor,-(t.stageY-this._distance.y)/Physics.factor);this.sk.position[0]=this._skP.x+i.x,this.sk.position[1]=this._skP.y+i.y},e.prototype.weiyi=function(i){var e=(t.scene_anch_x-t.scene_wy_limit,t.scene_anch_y-t.scene_wy_limit,t.scene_anch_x+t.scene_wy_limit+this.stage.stageWidth),n=(t.scene_anch_y+t.scene_wy_limit+this.stage.stageHeight,.5*this.stage.stageWidth),a=.5*this.stage.stageHeight,o=t.scene_anch_x+n,s=(t.scene_anch_y+a,0);i.x<o&&(s=this.x+(o-i.x),s=s>e?e:s,this.x=s),i.x>t.scene_anch_x+n},e}(egret.DisplayObjectContainer);t.SceneBase=i,__reflect(i.prototype,"scene.SceneBase")}(scene||(scene={}));var wuqi;!function(t){var i;!function(t){t[t.PU_TONG=0]="PU_TONG",t[t.SAN_DAN=1]="SAN_DAN",t[t.JI_GUANG=2]="JI_GUANG",t[t.DAO_DAN=3]="DAO_DAN",t[t.DA_PAO=4]="DA_PAO",t[t.ZHI_DAO_JI_GUANG=5]="ZHI_DAO_JI_GUANG",t[t.CHUAN_JIA_DAN=6]="CHUAN_JIA_DAN",t[t.YUN_BAO_DAN=7]="YUN_BAO_DAN"}(i=t.WUQI_TYPE||(t.WUQI_TYPE={}));var e=function(t){function i(i,e,n,a,o){var s=t.call(this,i,e,n,o)||this;return s.cd=1e3,s.mark_time=0,s.sudu=5,s}return __extends(i,t),i.prototype.updata_wq=function(i){t.prototype.updata.call(this);var e=egret.getTimer();e-this.mark_time>this.cd&&(this.mark_time=e,this.fashe(i))},i.prototype.fashe=function(t){},i}(mokuai.MoKuaiBase);t.WuQiBase=e,__reflect(e.prototype,"wuqi.WuQiBase")}(wuqi||(wuqi={}));var zhuangtaiji;!function(t){var i=function(){function t(){}return t.prototype.upStep=function(t){},t}();t.ZhuangTaiJiBase=i,__reflect(i.prototype,"zhuangtaiji.ZhuangTaiJiBase")}(zhuangtaiji||(zhuangtaiji={}));var ai;!function(t){var i=function(t){function i(i,e,n){var a=t.call(this,i)||this;return a.is_u=!0,a.point_index=0,a.wu_cha=1,a.points=e,a.is_loop=n,a.fc.p2_target=e[0],a}return __extends(i,t),i.prototype.doUpData=function(i){if(!this.hang_up){t.prototype.doUpData.call(this,i);var e=egret.Point.distance(egret.Point.create(this.points[this.point_index].x,this.points[this.point_index].y),egret.Point.create(this.fc.position[0],this.fc.position[1]));if(e<this.wu_cha)return this.is_u=!0,this.point_index++,this.point_index>=this.points.length?this.is_loop?(this.point_index=0,void(this.fc.p2_target=this.points[this.point_index])):(this.hang_up=!0,void(this.fc.p2_target=null)):void(this.fc.p2_target=this.points[this.point_index]);if(this.is_u){Math.atan2(this.suke.position[1]-this.fc.position[1],this.suke.position[0]-this.fc.position[0]);this.rx=.1*(this.points[this.point_index].x-this.fc.position[0]),this.ry=.1*(this.points[this.point_index].y-this.fc.position[1]),this.is_u=!1}this.fc.velocity=[this.rx,this.ry]}},i}(t.AiBase);t.MoveToAi=i,__reflect(i.prototype,"ai.MoveToAi")}(ai||(ai={}));var ai;!function(t){var i;!function(t){t[t.x=0]="x",t[t.y=1]="y",t[t.all=2]="all"}(i=t.RANDOM_POINT||(t.RANDOM_POINT={}));var e=function(t){function e(i,e,n){var a=t.call(this,i)||this;return a.is_u=!0,a.d_limit=n,a.random_type=e,a.r_point=a.random_p(),a}return __extends(e,t),e.prototype.doUpData=function(t){var i=egret.Point.distance(egret.Point.create(this.r_point.x,this.r_point.y),egret.Point.create(this.fc.position[0],this.fc.position[1]));if(egret.log("KKKKKKKKKKKKKK:"+i),.3>i&&(this.r_point=this.random_p(),this.is_u=!0),this.is_u){Math.atan2(this.suke.position[1]-this.fc.position[1],this.suke.position[0]-this.fc.position[0]);this.rx=.1*(this.r_point.x-this.fc.position[0]),this.ry=.1*(this.r_point.y-this.fc.position[1]),this.is_u=!1}this.fc.velocity=[this.rx,this.ry]},e.prototype.random_p=function(){var t=Math.random()*this.d_limit*2-this.d_limit,e=Math.random()*this.d_limit*2-this.d_limit;return this.random_type==i.x?egret.Point.create(this.fc.position[0]+t,this.fc.position[1]):this.random_type==i.y?egret.Point.create(this.fc.position[0],this.fc.position[1]+e):this.random_type==i.all?egret.Point.create(this.fc.position[0]+t,this.fc.position[1]+e):null},e}(t.AiBase);t.RandomPointAi=e,__reflect(e.prototype,"ai.RandomPointAi")}(ai||(ai={}));var ai;!function(t){var i=function(t){function i(i){return t.call(this,i)||this}return __extends(i,t),i.prototype.doUpData=function(i){if(!this.hang_up){t.prototype.doUpData.call(this,i);var e=Math.atan2(this.suke.position[1]-this.fc.position[1],this.suke.position[0]-this.fc.position[0])+.5*Math.PI;this.fc.angle=e}},i}(t.AiBase);t.ShiShiMiaoZhunAi=i,__reflect(i.prototype,"ai.ShiShiMiaoZhunAi")}(ai||(ai={}));var ai;!function(t){var i=function(t){function i(i,e){var n=t.call(this,i)||this;return n.xs=e,n}return __extends(i,t),i.prototype.doUpData=function(i){this.hang_up||(t.prototype.doUpData.call(this,i),this.fc.angularVelocity=this.xs)},i}(t.AiBase);t.XuanZhuanAI=i,__reflect(i.prototype,"ai.XuanZhuanAI")}(ai||(ai={}));var ai;!function(t){var i=function(i){function e(t){var e=i.call(this,t)||this;return e.xs=.5,e.fc.angularDamping=.9,e}return __extends(e,i),e.prototype.doUpData=function(i){if(!this.hang_up&&this.fc.p2_target){var e=Math.atan2(this.fc.p2_target.y-this.fc.position[1],this.fc.p2_target.x-this.fc.position[0])+.5*Math.PI,n=Math.PI+1.57;this.fc.angle>n&&(this.fc.angle=this.fc.angle-2*Math.PI),this.fc.angle<.5*-Math.PI&&(this.fc.angle=n),e>=0&&this.fc.angle>=0&&(Math.abs(e-this.fc.angle)<Math.PI?e<this.fc.angle?this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Clockwise:this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Anti_clockwise:e<this.fc.angle?this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Anti_clockwise:this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Clockwise),0>e&&this.fc.angle>=0&&(Math.abs(e)+this.fc.angle<Math.PI?this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Clockwise:this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Anti_clockwise),this.fc.angle<0&&e>=0&&(Math.abs(e)+this.fc.angle<Math.PI?this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Anti_clockwise:this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Clockwise),this.fc.angle<0&&0>e&&(this.fc.angle<e?this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Anti_clockwise:this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Clockwise),this.xuan_zhuan_fang_xiang==t.ZHUAN_XIANG.Clockwise&&Math.abs(this.fc.angle-e)>.1&&(this.fc.angularVelocity=-this.xs),this.xuan_zhuan_fang_xiang==t.ZHUAN_XIANG.Anti_clockwise&&Math.abs(this.fc.angle-e)>.1&&(this.fc.angularVelocity=this.xs)}},e}(t.AiBase);t.ZhuanXiang=i,__reflect(i.prototype,"ai.ZhuanXiang")}(ai||(ai={}));var canhai;!function(t){var i=function(t){function i(i,e){var n=t.call(this,i.battle_scene,egret.Point.create(500,500),GameConstant.ZHEN_YING.ZHONG_LI)||this;return n.fc_type=feichuan.FC_TYPE.CANHAI,n.yuntu=e,n.zhuji=i,n.initCanhai(),n}return __extends(i,t),i.prototype.initCanhai=function(){for(var t=100,i=100,e=0,n=0,a=0,o=this.yuntu;a<o.length;a++){var s=o[a];s&&(s.moKuaiPost.x<i&&(i=s.moKuaiPost.x),s.moKuaiPost.y<t&&(t=s.moKuaiPost.y),s.moKuaiPost.x>e&&(e=s.moKuaiPost.x),s.moKuaiPost.y>n&&(n=s.moKuaiPost.y))}for(var r=n-t+1,h=e-i+1,u=new Array,c=0;r>=c;c++){u[c]=new Array;for(var _=0;h>=_;_++)u[c].push(0)}for(var p=0,l=this.yuntu;p<l.length;p++){var s=l[p];u[s.moKuaiPost.y-t][s.moKuaiPost.x-i]=2}this.initPro(u);var f=this.yuntu[0],g=this.moKuaiList[f.moKuaiPost.y-t][f.moKuaiPost.x-i],d=Math.PI/180*360-this.zhuji.angle,y=Math.cos(d)*(f.boxShape.position[0]-g.boxShape.position[0])+Math.sin(d)*(f.boxShape.position[1]-g.boxShape.position[1]),m=-Math.sin(d)*(f.boxShape.position[0]-g.boxShape.position[0])+Math.cos(d)*(f.boxShape.position[1]-g.boxShape.position[1]);this.position[0]=this.zhuji.position[0]+y,this.position[1]=this.zhuji.position[1]+m,this.angle=this.zhuji.angle,this.velocity=[0,-1]},i}(feichuan.FeiChuanBase);t.CanHai=i,__reflect(i.prototype,"canhai.CanHai")}(canhai||(canhai={}));var GameConstant;!function(t){function i(i){i.updataFenJie();var o=i.moKuaiList;t.mark=0;var s;i.fc_type==feichuan.FC_TYPE.DIJI&&(s=i.hx,s&&(s.mark_number=t.mark)),i.fc_type==feichuan.FC_TYPE.CANHAI&&(s=e(i)),n(o,s,i),a(o,i)}function e(i){for(var e=0;e<i.moKuaiList.length;e++)for(var n=0;n<i.moKuaiList[e].length;n++)if(i.moKuaiList[e][n])return i.moKuaiList[e][n].mark_number=t.mark,i.moKuaiList[e][n]}function n(i,e,n){if(e){for(t.hearList=new Array,t.hearList.push(e);t.hearList.length>0;)s(i,t.hearList.shift(),n);for(var a=0;10>a&&o(i,n);a++);}else for(var r=0;r<i.length;r++)for(var h=0;h<i[r].length;h++)i[r][h]&&(i[r][h].mark_number=1)}function a(t,i){for(var e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++)if(t[e][n]){if(t[e][n].mark_number>0){i.fen_jie[t[e][n].mark_number].push(t[e][n]),i.removeShape(t[e][n].boxShape),i.battle_scene.removeChild(t[e][n]),t[e][n]=null;continue}t[e][n].mark_number=-1}}function o(i,e){t.mark++,t.hearList=new Array;for(var n=!1,a=0;a<i.length;a++){for(var o=0;o<i[a].length;o++)if(i[a][o]&&-1==i[a][o].mark_number){i[a][o].mark_number=t.mark,t.hearList.push(i[a][o]),n=!0;break}if(n)break}for(;t.hearList.length>0;)s(i,t.hearList.shift(),e);return n}function s(i,e,n){var a,o,s=e.moKuaiPost.x,h=e.moKuaiPost.y;a=h-1,o=s,r(i,t.mark,a,o,n),a=h+1,o=s,r(i,t.mark,a,o,n),a=h,o=s-1,r(i,t.mark,a,o,n),a=h,o=s+1,r(i,t.mark,a,o,n)}function r(i,e,n,a,o){n>=0&&a>=0&&n<i.length&&a<i[0].length&&i[n][a]&&-1==i[n][a].mark_number&&(i[n][a].mark_number=e,t.hearList.push(i[n][a]))}function h(t){for(var i=!1,e=0;e<t.moKuaiList.length;e++)for(var n=0;n<t.moKuaiList[e].length;n++)t.moKuaiList[e][n]&&(i=!0);if(!i){var a=t.battle_scene.dijis.indexOf(t);return t.battle_scene.dijis.splice(a),t.battle_scene.world.removeBody(t),t=null,!1}return!0}var u;!function(t){t[t.WO_JUN=0]="WO_JUN",t[t.DI_JUN=1]="DI_JUN",t[t.ZHONG_LI=2]="ZHONG_LI"}(u=t.ZHEN_YING||(t.ZHEN_YING={})),t.WO_JUN=Math.pow(2,1),t.DI_JUN=Math.pow(2,2),t.ZHONG_LI=Math.pow(2,3),t.mark=0,t.diaoluo=i,t.chackMoKuaiNumber=h}(GameConstant||(GameConstant={}));var Main=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i._distance=new egret.Point,i}return __extends(i,t),i.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var i=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",i),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadResource()},i.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return e.sent(),[4,RES.loadGroup("testLoad",0,t)];case 2:return e.sent(),[4,this.stage.removeChild(t)];case 3:return e.sent(),this.addTestScene(),[3,5];case 4:return i=e.sent(),console.error(i),[3,5];case 5:return[2]}})})},i.prototype.addTestScene=function(){this.testSen=new TestScene,this.stage.addChild(this.testSen),this.testSen.x=-scene.scene_anch_x,this.testSen.y=-scene.scene_anch_y},i}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var LoadingUI=function(t){function i(){var i=t.call(this)||this;return i.createView(),i}return __extends(i,t),i.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},i.prototype.onProgress=function(t,i){this.textField.text="Loading..."+t+"/"+i},i}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,i,e,n){function a(t){i.call(n,t)}function o(i){i.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),e.call(n))}"undefined"!=typeof generateEUI?egret.callLater(function(){i.call(n,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,a,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var mokuai;!function(t){var i=function(i){function e(e,n,a,o){var s=i.call(this,e,n,a,o)||this;return s.moKuaiType=t.MO_KUAI_TYPE.HE_XIN,s}return __extends(e,i),e}(t.MoKuaiBase);t.DongLiHeXin=i,__reflect(i.prototype,"mokuai.DongLiHeXin")}(mokuai||(mokuai={}));var Physics;!function(t){function i(t,i,e){var n,a,o=i.x;n=(o-t.x/2)*e,0>n&&(n+=.5*e),n>0&&(n+=.5*e),0==n&&(n=.5*e),1==t.x&&(n=0),o-t.x/2==-.5&&(n=0);var s=t.y-i.y-1;return a=(s-t.y/2)*e,0>a&&(a+=.5*e),a>0&&(a+=.5*e),0==a&&(a=.5*e),1==t.y&&(a=0),s-t.y/2==-.5&&(a=0),egret.Point.create(n,a)}t.factor=50,t.getRelativeDistance=i}(Physics||(Physics={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,i,e){function n(n){i.call(e,n,t)}if(RES.hasRes(t)){var a=RES.getRes(t);a?n(a):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var shuke;!function(t){var i=function(t){function i(i){var e=t.call(this,i,egret.Point.create(scene.scene_anch_x+320,2100),GameConstant.ZHEN_YING.WO_JUN)||this;return e.fc_type=feichuan.FC_TYPE.SUKE,e.initSuKe(),e}return __extends(i,t),i.prototype.initYunTU=function(){this.yun_tu=[[1,2,2,2,3]]},i.prototype.initSuKe=function(){this.initYunTU(),this.initPro(this.yun_tu)},i.prototype.updataPos=function(){t.prototype.updataPos.call(this)},i}(feichuan.FeiChuanBase);t.ShuKe=i,__reflect(i.prototype,"shuke.ShuKe")}(shuke||(shuke={}));var test;!function(t){var i;!function(t){t[t.nll=0]="nll",t[t.hx=1]="hx",t[t.zj=2]="zj"}(i=t.yuntu_type||(t.yuntu_type={}));var e=function(t){function i(i){var e=t.call(this,i,egret.Point.create(1200,1300),GameConstant.ZHEN_YING.DI_JUN)||this;return e.fc_type=feichuan.FC_TYPE.DIJI,e.initJson("6_1_json"),e.initTestFchuan(),e}return __extends(i,t),i.prototype.initTestFchuan=function(){this.angularDamping=0,this.mass=100,this.addAI(new ai.RandomPointAi(this,ai.RANDOM_POINT.all,2))},i}(feichuan.FeiChuanBase);t.TestFeiChuan=e,__reflect(e.prototype,"test.TestFeiChuan")}(test||(test={}));var test;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.drawGrid(),i}return __extends(i,t),i.prototype.drawGrid=function(){this.graphics.beginFill(0),this.graphics.drawRect(0,0,scene.battle_sceneW,scene.battle_sceneH),this.graphics.endFill(),this.graphics.lineStyle(.2,16777215);for(var t=0;t<scene.battle_sceneH/100;t++)this.graphics.moveTo(0,100*t),this.graphics.lineTo(scene.battle_sceneW,100*t);this.graphics.endFill(),this.graphics.lineStyle(.2,16777215);for(var t=0;t<scene.battle_sceneW/100;t++)this.graphics.moveTo(100*t,0),this.graphics.lineTo(100*t,scene.battle_sceneH);this.graphics.endFill()},i}(egret.Sprite);t.TestGrid=i,__reflect(i.prototype,"test.TestGrid")}(test||(test={}));var TestScene=function(t){function i(){var i=t.call(this)||this;return i.initTest(),i}return __extends(i,t),i.prototype.initTest=function(){var t=(egret.Point.create(1200,1200),new test.TestGrid);t.x=0,t.y=0,this.addChild(t);var i=new shuke.ShuKe(this);this.sk=i;var e=new test.TestFeiChuan(this);this.dijis.push(e)},i}(scene.SceneBase);__reflect(TestScene.prototype,"TestScene");var Tools;!function(t){function i(t){return egret.Point.create(t.x*Physics.factor,scene.battle_sceneH-t.y*Physics.factor)}function e(t){return egret.Point.create(t.x/Physics.factor,(scene.battle_sceneH-t.y)/Physics.factor)}t.p2TOegretPoitn=i,t.egretTOp2=e}(Tools||(Tools={}));var wuqi;!function(t){var i=function(t){function i(i,e,n,a,o){return t.call(this,i,e,n,a,o)||this}return __extends(i,t),i.prototype.fashe=function(t){},i}(t.WuQiBase);t.PuTongDan=i,__reflect(i.prototype,"wuqi.PuTongDan")}(wuqi||(wuqi={}));var ai;!function(t){var i=function(t){function i(i,e){var n=t.call(this,i)||this;return n.xs=e,n}return __extends(i,t),i.prototype.doUpData=function(t){if(!this.hang_up){var i=egret.Point.distance(egret.Point.create(this.suke.position[0],this.suke.position[1]),egret.Point.create(this.fc.position[0],this.fc.position[1]));if(i<this.xs)return;var e=.1*(this.suke.position[0]-this.fc.position[0]),n=.1*(this.suke.position[1]-this.fc.position[1]);this.fc.velocity=[e,n]}},i}(t.AiBase);t.KeepDistanceAI=i,__reflect(i.prototype,"ai.KeepDistanceAI")}(ai||(ai={}));var ai;!function(t){var i=function(i){function e(t,e){var n=i.call(this,t)||this;return n.is_xuan_ting=!1,n.xs=e,n}return __extends(e,i),e.prototype.doUpData=function(e){if(!this.hang_up){i.prototype.doUpData.call(this,e);var n=Math.atan2(this.suke.position[1]-this.fc.position[1],this.suke.position[0]-this.fc.position[0])+.5*Math.PI,a=Math.PI+1.57;this.fc.angle>a&&(this.fc.angle=this.fc.angle-2*Math.PI),this.fc.angle<.5*-Math.PI&&(this.fc.angle=a),n>=0&&this.fc.angle>=0&&(Math.abs(n-this.fc.angle)<Math.PI?n<this.fc.angle?this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Clockwise:this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Anti_clockwise:n<this.fc.angle?this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Anti_clockwise:this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Clockwise),0>n&&this.fc.angle>=0&&(Math.abs(n)+this.fc.angle<Math.PI?this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Clockwise:this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Anti_clockwise),this.fc.angle<0&&n>=0&&(Math.abs(n)+this.fc.angle<Math.PI?this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Anti_clockwise:this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Clockwise),this.fc.angle<0&&0>n&&(this.fc.angle<n?this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Anti_clockwise:this.xuan_zhuan_fang_xiang=t.ZHUAN_XIANG.Clockwise),this.is_xuan_ting||(this.xuan_zhuan_fang_xiang==t.ZHUAN_XIANG.Clockwise&&(this.fc.angularVelocity=-this.xs),this.xuan_zhuan_fang_xiang==t.ZHUAN_XIANG.Anti_clockwise&&(this.fc.angularVelocity=this.xs))}},e}(t.AiBase);t.MiaoZhun=i,__reflect(i.prototype,"ai.MiaoZhun")}(ai||(ai={}));var duixing;!function(t){var i=function(t){function i(){return t.call(this)||this}return __extends(i,t),i}(zhuangtaiji.ZhuangTaiJiBase);t.DuiXingBase=i,__reflect(i.prototype,"duixing.DuiXingBase")
}(duixing||(duixing={}));var fjztj;!function(t){var i=function(t){function i(){return t.call(this)||this}return __extends(i,t),i}(zhuangtaiji.ZhuangTaiJiBase);t.FjZTJ=i,__reflect(i.prototype,"fjztj.FjZTJ")}(fjztj||(fjztj={}));var pici;!function(t){var i=function(t){function i(){return t.call(this)||this}return __extends(i,t),i}(zhuangtaiji.ZhuangTaiJiBase);t.PiCiBase=i,__reflect(i.prototype,"pici.PiCiBase")}(pici||(pici={}));var zidan;!function(t){var i=function(t){function i(i,e){var n=t.call(this,i,e,wuqi.WUQI_TYPE.PU_TONG)||this;return n.initPT(),n}return __extends(i,t),i.prototype.initPT=function(){this.bitmap=new egret.Bitmap(RES.getRes("lv_dian_png")),this.damping=0,this.displays=[this.bitmap]},i.prototype.updata=function(){t.prototype.updata.call(this)},i}(t.ZiDanBase);t.PuTongZiDan=i,__reflect(i.prototype,"zidan.PuTongZiDan")}(zidan||(zidan={}));var zhuangjia;!function(t){var i=function(t){function i(i,e,n,a){var o=t.call(this,i,e,n,a)||this;return o.number=3,o}return __extends(i,t),i.prototype.Defense=function(){return this.markNumber--,this.markNumber<=0?!1:!0},i}(t.ZhuangJiaBase);t.PuTongZhuangJia=i,__reflect(i.prototype,"zhuangjia.PuTongZhuangJia")}(zhuangjia||(zhuangjia={}));