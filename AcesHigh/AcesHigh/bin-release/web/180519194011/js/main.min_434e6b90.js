var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(s,r){function o(t){try{u(n.next(t))}catch(e){r(e)}}function a(t){try{u(n["throw"](t))}catch(e){r(e)}}function u(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(o,a)}u((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(o=u.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(n){i=[6,n],r=0}finally{s=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,r,o,a,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},mokuai;!function(t){var e;!function(t){t[t.TOP=0]="TOP",t[t.BOTTOM=1]="BOTTOM",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"}(e=t.ConstraintDirect||(t.ConstraintDirect={}));var i;!function(t){t[t.SIMPLE=0]="SIMPLE",t[t.FF=1]="FF",t[t.NN=2]="NN"}(i=t.BODY_SHAPE_TYPE||(t.BODY_SHAPE_TYPE={}));var n;!function(t){t[t.HE_XIN=0]="HE_XIN",t[t.ZHUANG_JIA=1]="ZHUANG_JIA",t[t.WU_QI=2]="WU_QI",t[t.CAN_HAI=3]="CAN_HAI"}(n=t.MO_KUAI_TYPE||(t.MO_KUAI_TYPE={})),t.SIMPLE_SIZE=16,t.FF_SIZE=32,t.NN_SIZE=48,t.SIMPLE_SIZE_PH=.32,t.FF_SIZE_PH=.64,t.NN_SIZE_PH=.96,t.M_SIZE=[t.SIMPLE_SIZE,t.FF_SIZE,t.NN_SIZE],t.M_SIZE_PH=[t.SIMPLE_SIZE_PH,t.FF_SIZE_PH,t.NN_SIZE_PH];var s=function(e){function i(t,i,n,s){var r=e.call(this,RES.getRes(s))||this;return r.isOdd_W=!1,r.isOdd_H=!1,r.relativeDistance=egret.Point.create(0,0),r.shapeType=n,r.moKuaiPost=t,r.bodySize=i,r.initAnch(),r.initRelativeDis(),r}return __extends(i,e),i.prototype.initRelativeDis=function(){var e,i;e=this.moKuaiPost.x-this.bodySize.x/2*t.M_SIZE[this.shapeType],0>e&&(e+=.5*t.M_SIZE[this.shapeType]),e>0&&(e-=.5*t.M_SIZE[this.shapeType]),this.relativeDistance.x=e,i=this.moKuaiPost.y-this.bodySize.y/2*t.M_SIZE[this.shapeType],0>i&&(i+=.5*t.M_SIZE[this.shapeType]),i>0&&(i-=.5*t.M_SIZE[this.shapeType]),this.relativeDistance.y=i},i.prototype.initAnch=function(){this.anchorOffsetX=.5*this.width,this.anchorOffsetY=.5*this.height},i.prototype.UpdataPosition=function(t){this.x=t.x+this.relativeDistance.x,this.y=t.y+this.relativeDistance.y},i}(egret.Bitmap);t.MoKuaiBase=s,__reflect(s.prototype,"mokuai.MoKuaiBase")}(mokuai||(mokuai={}));var zhuangjia;!function(t){var e=function(t){function e(e,i,n,s){var r=t.call(this,e,i,n,s)||this;return r.moKuaiType=mokuai.MO_KUAI_TYPE.ZHUANG_JIA,r}return __extends(e,t),e}(mokuai.MoKuaiBase);t.ZhuangJiaBase=e,__reflect(e.prototype,"zhuangjia.ZhuangJiaBase")}(zhuangjia||(zhuangjia={}));var feichuan;!function(t){var e=function(t){function e(e,i,n,s){var r=t.call(this,{mass:1})||this;return r.heXinList=new Array,r.zhuangJaList=new Array,r.W=e,r.H=i,r.egretWorldPoint=s,r.battle_scene=n,r.initPhPost(),r}return __extends(e,t),e.prototype.initPhPost=function(){var t=Tools.egretTOp2(this.egretWorldPoint);this.position[0]=t.x,this.position[1]=t.y},e.prototype.initList=function(t,e){this.moKuaiList=new Array,this.boxList=new Array;for(var i=0;t>i;i++)this.moKuaiList.push(new Array(e)),this.boxList.push(new Array(e))},e.prototype.updataPos=function(){for(var t=this.boxList.length,e=this.boxList[0].length,i=0;t>i;i++)for(var n=0;e>n;n++){var s=this.boxList[i][n],r=this.moKuaiList[i][n];if(null!=s){var o=Tools.p2TOegretPoitn(egret.Point.create(s.position[0]+this.position[0],s.position[1]+this.position[1]));r.x=o.x,r.y=o.y,r.rotation=360-180*s.angle/Math.PI}}},e}(p2.Body);t.FeiChuanBase=e,__reflect(e.prototype,"feichuan.FeiChuanBase")}(feichuan||(feichuan={}));var scene;!function(t){t.battle_sceneW=4e3,t.battle_sceneH=4e3,t.scene_anch_x=1e3,t.scene_anch_y=1e3;var e=function(e){function i(){var t=e.call(this)||this;return t._distance=new egret.Point,t._skP=new egret.Point,t.init(),t}return __extends(i,e),i.prototype.init=function(){this.width=t.battle_sceneW,this.height=t.battle_sceneH,this.world=new p2.World,this.world.sleepMode=p2.World.BODY_SLEEPING,this.world.gravity=[0,0],this.addShuKeListener(),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.dijis=new Array},i.prototype.onEnterFrame=function(){this.p2Updata()},i.prototype.p2Updata=function(){this.world.step(.06);for(var t=this.world.bodies.length,e=0;t>e;e++){var i=this.world.bodies[e];if(i instanceof feichuan.FeiChuanBase){var n=i;n.updataPos()}else{var s=i.displays[0];if(s){var r=Tools.p2TOegretPoitn(egret.Point.create(i.position[0],i.position[1]));s.x=r.x,s.y=r.y,s.rotation=360-180*i.angle/Math.PI}}}},i.prototype.addShuKeListener=function(){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this)},i.prototype.mouseUp=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},i.prototype.mouseDown=function(t){this._distance.x=t.stageX,this._distance.y=t.stageY,this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},i.prototype.mouseMove=function(t){egret.Point.create((t.stageX-this._distance.x)/Physics.factor,-(t.stageY-this._distance.y)/Physics.factor)},i}(egret.DisplayObjectContainer);t.SceneBase=e,__reflect(e.prototype,"scene.SceneBase")}(scene||(scene={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(n,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._distance=new egret.Point,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadResource()},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("testLoad",0,t)];case 2:return i.sent(),[4,this.stage.removeChild(t)];case 3:return i.sent(),this.addTestScene(),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.addTestScene=function(){this.testSen=new TestScene,this.stage.addChild(this.testSen),this.testSen.x=-scene.scene_anch_x,this.testSen.y=-scene.scene_anch_y,this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this)},e.prototype.mouseUp=function(t){this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},e.prototype.mouseDown=function(t){this._distance.x=t.stageX-this.testSen.x,this._distance.y=t.stageY-this.testSen.y,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},e.prototype.mouseMove=function(t){this.testSen.x=t.stageX-this._distance.x,this.testSen.y=t.stageY-this._distance.y},e}(eui.UILayer);__reflect(Main.prototype,"Main");var zhuangjia;!function(t){var e=function(t){function e(e,i,n,s){var r=t.call(this,e,i,n,s)||this;return r.moKuaiType=mokuai.MO_KUAI_TYPE.ZHUANG_JIA,r}return __extends(e,t),e}(t.ZhuangJiaBase);t.PuTongZhuangJia=e,__reflect(e.prototype,"zhuangjia.PuTongZhuangJia")}(zhuangjia||(zhuangjia={}));var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var mokuai;!function(t){var e=function(e){function i(i,n,s,r){var o=e.call(this,i,n,s,r)||this;return o.moKuaiType=t.MO_KUAI_TYPE.HE_XIN,o.initDongli(),o}return __extends(i,e),i.prototype.initDongli=function(){},i}(t.MoKuaiBase);t.DongLiHeXin=e,__reflect(e.prototype,"mokuai.DongLiHeXin")}(mokuai||(mokuai={}));var Physics;!function(t){function e(t,e,i){var n,s;return n=e.x-t.x/2*i,0>n&&(n+=.5*i),n>0&&(n-=.5*i),s=e.y-t.y/2*i,0>s&&(s+=.5*i),s>0&&(s-=.5*i),egret.Point.create(n,s)}t.factor=50,t.getRelativeDistance=e}(Physics||(Physics={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var shuke;!function(t){var e=function(t){function e(e){var i=t.call(this,10,10,e,egret.Point.create(1100,1100))||this;return i.initSuKe(),i}return __extends(e,t),e.prototype.initSuKe=function(){var t=egret.Point.create(1500,1500),e=egret.Point.create(0,0),i=new mokuai.DongLiHeXin(t,e,mokuai.BODY_SHAPE_TYPE.SIMPLE,"lan_dian_png");this.heXinList.push(i)},e}(feichuan.FeiChuanBase);t.ShuKe=e,__reflect(e.prototype,"shuke.ShuKe")}(shuke||(shuke={}));var test;!function(t){var e;!function(t){t[t.nll=0]="nll",t[t.hx=1]="hx",t[t.zj=2]="zj"}(e=t.yuntu_type||(t.yuntu_type={}));var i=function(t){function e(e){var i=t.call(this,10,10,e,egret.Point.create(1100,1100))||this;return i.initTestFchuan(),i}return __extends(e,t),e.prototype.initTestFchuan=function(){this.initYunTU(),this.initPro()},e.prototype.initYunTU=function(){this.yun_tu=[[2,2,2,2,2,2,2]]},e.prototype.initPro=function(){var t=egret.Point.create(this.yun_tu[0].length,this.yun_tu.length);this.initList(this.yun_tu.length,this.yun_tu[0].length);for(var e=0;e<this.yun_tu.length;e++)for(var i=0;i<this.yun_tu[0].length;i++){if(0!=this.yun_tu[e][i])if(1!=this.yun_tu[e][i])if(2!=this.yun_tu[e][i]);else{var n=new zhuangjia.PuTongZhuangJia(egret.Point.create(i,e),t,mokuai.BODY_SHAPE_TYPE.SIMPLE,"hong_dian_png"),s=Physics.getRelativeDistance(t,egret.Point.create(i,e),mokuai.M_SIZE_PH[mokuai.BODY_SHAPE_TYPE.SIMPLE]),r=new p2.Box({width:mokuai.M_SIZE_PH[mokuai.BODY_SHAPE_TYPE.SIMPLE],height:mokuai.M_SIZE_PH[mokuai.BODY_SHAPE_TYPE.SIMPLE]});this.addShape(r,[s.x,s.y]),this.moKuaiList[e][i]=n,this.boxList[e][i]=r,this.battle_scene.addChild(n)}else{var n=new mokuai.DongLiHeXin(egret.Point.create(i,e),t,mokuai.BODY_SHAPE_TYPE.SIMPLE,"hong_dian_png"),s=Physics.getRelativeDistance(t,egret.Point.create(i,e),mokuai.M_SIZE_PH[mokuai.BODY_SHAPE_TYPE.SIMPLE]),r=new p2.Box({width:mokuai.M_SIZE_PH[mokuai.BODY_SHAPE_TYPE.SIMPLE],height:mokuai.M_SIZE_PH[mokuai.BODY_SHAPE_TYPE.SIMPLE]});egret.log("HHHHHHHHHHHHHH:"+s.x+"_"+s.y),this.addShape(r,[s.x,s.y]),this.moKuaiList[e][i]=n,this.boxList[e][i]=r,this.battle_scene.addChild(n)}}this.battle_scene.world.addBody(this)},e}(feichuan.FeiChuanBase);t.TestFeiChuan=i,__reflect(i.prototype,"test.TestFeiChuan")}(test||(test={}));var test;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.drawGrid(),e}return __extends(e,t),e.prototype.drawGrid=function(){this.graphics.beginFill(0),this.graphics.drawRect(0,0,scene.battle_sceneW,scene.battle_sceneH),this.graphics.endFill(),this.graphics.lineStyle(.2,16777215);for(var t=0;t<scene.battle_sceneH/100;t++)this.graphics.moveTo(0,100*t),this.graphics.lineTo(scene.battle_sceneW,100*t);this.graphics.endFill(),this.graphics.lineStyle(.2,16777215);for(var t=0;t<scene.battle_sceneW/100;t++)this.graphics.moveTo(100*t,0),this.graphics.lineTo(100*t,scene.battle_sceneH);this.graphics.endFill()},e}(egret.Sprite);t.TestGrid=e,__reflect(e.prototype,"test.TestGrid")}(test||(test={}));var TestScene=function(t){function e(){var e=t.call(this)||this;return e.initTest(),e}return __extends(e,t),e.prototype.initTest=function(){var t=(egret.Point.create(1200,1200),new test.TestGrid);t.x=0,t.y=0,this.addChild(t);var e=new test.TestFeiChuan(this);this.dijis.push(e)},e}(scene.SceneBase);__reflect(TestScene.prototype,"TestScene");var Tools;!function(t){function e(t){return egret.Point.create(t.x*Physics.factor,scene.battle_sceneH-t.y*Physics.factor)}function i(t){return egret.Point.create(t.x/Physics.factor,(scene.battle_sceneH-t.y)/Physics.factor)}t.p2TOegretPoitn=e,t.egretTOp2=i}(Tools||(Tools={}));